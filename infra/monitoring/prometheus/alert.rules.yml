groups:
  - name: fanzip-server-alerts
    rules:
      # ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¤ìš´ (ê°€ì¥ ì¤‘ìš”!)
      - alert: ApplicationDown
        expr: up{job="fanzip-application"} == 0
        for: 1m
        labels:
          severity: critical
          service: fanzip-server
        annotations:
          summary: "ğŸš¨ ì„œë¹„ìŠ¤ ë‹¤ìš´!"
          description: "Fanzip ì„œë²„ê°€ 1ë¶„ê°„ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"

      # ë†’ì€ CPU ì‚¬ìš©ë¥ 
      - alert: HighCpuUsage
        expr: process_cpu_usage > 0.8
        for: 3m
        labels:
          severity: warning
          service: fanzip-server
        annotations:
          summary: "âš ï¸ CPU ì‚¬ìš©ë¥  ë†’ìŒ"
          description: "CPU ì‚¬ìš©ë¥ ì´ {{ $value | humanizePercentage }}ë¡œ 80%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"

      # ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
      - alert: HighMemoryUsage
        expr: sum(jvm_memory_used_bytes{area="heap"}) / sum(jvm_memory_max_bytes{area="heap"} > 0) > 0.85
        for: 2m
        labels:
          severity: warning
          service: fanzip-server
        annotations:
          summary: "âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ë†’ìŒ"
          description: "í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ {{ $value | humanizePercentage }}ë¡œ 85%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"

      # ë†’ì€ ì‹œìŠ¤í…œ ë¡œë“œ
      - alert: HighSystemLoad
        expr: system_load_average_1m > 6
        for: 2m
        labels:
          severity: warning
          service: fanzip-server
        annotations:
          summary: "âš ï¸ ì‹œìŠ¤í…œ ë¡œë“œ ë†’ìŒ"
          description: "ì‹œìŠ¤í…œ ë¡œë“œê°€ {{ $value }}ë¡œ 6ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"

      # API ì—ëŸ¬ìœ¨ ë†’ìŒ
      - alert: HighApiErrorRate
        expr: rate(fanzip_api_calls_total{status=~"5.."}[5m]) / rate(fanzip_api_calls_total[5m]) * 100 > 5
        for: 1m
        labels:
          severity: critical
          service: fanzip-server
        annotations:
          summary: "ğŸš¨ API ì—ëŸ¬ìœ¨ ë†’ìŒ"
          description: "5xx ì—ëŸ¬ìœ¨ì´ {{ $value }}%ë¡œ 5%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"

      # ë¡œê·¸ì¸ ì‹¤íŒ¨ìœ¨ ë†’ìŒ
      - alert: HighLoginFailureRate
        expr: rate(fanzip_user_login_failures_total[5m]) / rate(fanzip_user_login_attempts_total[5m]) * 100 > 30
        for: 2m
        labels:
          severity: warning
          service: fanzip-server
        annotations:
          summary: "âš ï¸ ë¡œê·¸ì¸ ì‹¤íŒ¨ìœ¨ ë†’ìŒ"
          description: "ë¡œê·¸ì¸ ì‹¤íŒ¨ìœ¨ì´ {{ $value }}%ë¡œ 30%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"

      # API ì‘ë‹µì‹œê°„ ë†’ìŒ
      - alert: SlowApiResponse
        expr: sum(rate(fanzip_api_response_duration_seconds_sum[5m])) / sum(rate(fanzip_api_response_duration_seconds_count[5m])) > 2
        for: 2m
        labels:
          severity: warning
          service: fanzip-server
        annotations:
          summary: "âš ï¸ API ì‘ë‹µ ëŠë¦¼"
          description: "í‰ê·  API ì‘ë‹µì‹œê°„ì´ {{ $value }}ì´ˆë¡œ 2ì´ˆë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"

      # ìŠ¤ë ˆë“œ ìˆ˜ ê¸‰ì¦
      - alert: TooManyThreads
        expr: jvm_threads_live_threads > 200
        for: 3m
        labels:
          severity: warning
          service: fanzip-server
        annotations:
          summary: "âš ï¸ ìŠ¤ë ˆë“œ ìˆ˜ ê¸‰ì¦"
          description: "í™œì„± ìŠ¤ë ˆë“œ ìˆ˜ê°€ {{ $value }}ê°œë¡œ 200ê°œë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"

      # ì‹ ê·œ ê°€ì…ì ê¸‰ê° (ë¹„ì¦ˆë‹ˆìŠ¤ ì•Œë¦¼)
      - alert: LowRegistrations
        expr: rate(fanzip_user_registrations_total[2h]) * 7200 < 1
        for: 30m
        labels:
          severity: warning
          service: fanzip-server
        annotations:
          summary: "ğŸ“‰ ì‹ ê·œ ê°€ì…ì ê¸‰ê°"
          description: "ìµœê·¼ 2ì‹œê°„ ë™ì•ˆ ì‹ ê·œ ê°€ì…ìê°€ {{ $value }}ëª…ìœ¼ë¡œ ë§¤ìš° ì ìŠµë‹ˆë‹¤"